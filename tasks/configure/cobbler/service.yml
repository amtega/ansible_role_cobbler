---
# Configure service tasks

- block:
    - name: enable and start cobblerd service
      service:
        name: cobblerd
        state: started
        enabled: yes

    - name: enable and start httpd service
      service:
        name: httpd
        state: started
        enabled: yes

    - name: enable and start rsyncd service
      service:
        name: rsyncd
        state: started
        enabled: yes
      when: ansible_facts.distribution_major_version is version("7", ">=")

    - name: download cobbler loaders
      command: cobbler get-loaders
      register: cobbler_rsync_result
      changed_when: cobbler_rsync_result.stdout is search("downloading")

    - meta: flush_handlers
  tags:
    - role::cobbler
    - role::cobbler::configure
    - role::cobbler::configure::service
